<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü–æ–π–º–∞–π —Ñ—É—Ç–±–æ–ª–∫—É ‚Äî MUVIT</title>
  <meta name="theme-color" content="#d1dce7" />
  <style>
    :root{
      --bg1:#d1dce7;
      --bg2:#e6edf3;
      --text:#44606e;
      --btn:#e3801e;
      --muted:#6e8a97;
      --panel:#ffffff;
      --border:#c7d3de;
    }
    @font-face{
      font-family:'MUVITBrand';
      src:url('./assets/centurygothic_bold.ttf') format('truetype');
      font-weight:700; font-style:normal; font-display:swap;
    }
    html,body{height:100%;margin:0}
    body{
      background: radial-gradient(1200px 700px at 70% -10%, var(--bg2) 0%, var(--bg1) 55%);
      color:var(--text);
      font-family:'MUVITBrand', system-ui, -apple-system, Segoe UI, Inter, Roboto, Arial;
      display:grid; place-items:center;
    }
    .wrap{width:min(760px,100%);padding:16px;}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:22px;overflow:hidden;box-shadow:0 10px 40px rgba(50,70,90,.15);}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border);}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{height:36px; animation:float 3s ease-in-out infinite;}
    @keyframes float{ 0%{transform:translateY(0)} 50%{transform:translateY(-4px)} 100%{transform:translateY(0)} }
    h1{font-size:20px;line-height:1.2;margin:0}
    h1 small{display:block;color:var(--muted);font-size:12px}
    .btn, .shop a{background:var(--btn);color:#fff;text-decoration:none;border:none;border-radius:12px;padding:12px 16px;cursor:pointer;font-weight:700;display:inline-block; box-shadow:0 6px 20px rgba(227,128,30,.25);}
    .btn.pulse{ animation:pulse 1.6s ease-in-out infinite; }
    @keyframes pulse{ 0%{transform:scale(1)} 50%{transform:scale(1.04)} 100%{transform:scale(1)} }
    .btn.ghost{background:#fff;color:var(--text);border:1px solid var(--border);box-shadow:none}
    .shop a:hover{opacity:.92}
    .game{position:relative;}
    canvas{width:100%;height:auto;display:block;background:linear-gradient(180deg,#edf3f7,#e4eef5);}
    .hud{position:absolute;left:12px;top:10px;right:12px;display:flex;justify-content:space-between;gap:8px;pointer-events:none}
    .pill{background:#f5f9fc;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:13px;color:var(--text);box-shadow:0 6px 16px rgba(0,0,0,.05)}
    .overlay{position:absolute;inset:0;display:grid;place-items:center;background:rgba(209,220,231,.6);backdrop-filter:blur(4px);}
    .screen{width:min(560px,92%);background:#fff;border:1px solid var(--border);border-radius:18px;padding:24px;text-align:center;box-shadow:0 12px 36px rgba(50,70,90,.18);position:relative; overflow:hidden;}
    .title{font-size:30px;margin:0 0 10px}
    .subtitle{margin:0 0 16px;color:var(--muted)}
    .badge{position:absolute; top:10px; right:-14px; background:#19c37d; color:#fff; padding:6px 16px; transform:rotate(12deg); border-radius:10px; font-size:13px; display:none; box-shadow:0 8px 20px rgba(25,195,125,.35);}
    .start-bg{position:absolute;inset:0;pointer-events:none;opacity:.35; filter:blur(2px);}
    .start-bg img{position:absolute; width:80px; transform:rotate(-10deg); opacity:.8; animation:float 4s ease-in-out infinite;}
    footer{padding:12px 14px;text-align:center;border-top:1px solid var(--border);color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="brand">
          <img src="assets/logo.png" alt="MUVIT" />
          <div>
            <h1>–ü–æ–π–º–∞–π —Ñ—É—Ç–±–æ–ª–∫—É <small>MUVIT ‚Äî –º–∏–Ω–∏‚Äë–∏–≥—Ä–∞</small></h1>
          </div>
        </div>
        <div class="shop">
          <a class="btn" href="https://clck.ru/3PW6wp" target="_blank" rel="noopener">üõç –°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ WB</a>
        </div>
      </header>

      <div class="game">
        <canvas id="game" width="640" height="960" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ"></canvas>

        <div class="hud">
          <div class="pill">–°—á—ë—Ç: <b id="score">0</b></div>
          <div class="pill">–ñ–∏–∑–Ω–∏: <b id="lives">3</b></div>
          <div class="pill">–†–µ–∫–æ—Ä–¥: <b id="best">0</b></div>
        </div>

        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
        <div class="overlay" id="startScreen">
          <div class="screen">
            <div class="start-bg">
              <img src="assets/tee1.png" style="left:20px; top:20px">
              <img src="assets/tee2.png" style="right:30px; top:50px; transform:rotate(12deg)">
              <img src="assets/tee3.png" style="left:60px; bottom:20px; transform:rotate(-6deg)">
            </div>
            <p><img src="assets/logo.png" alt="MUVIT" style="height:52px; animation:float 3s ease-in-out infinite;"></p>
            <p class="title">–ü–æ–π–º–∞–π —Ñ—É—Ç–±–æ–ª–∫—É</p>
            <p class="subtitle">–ò–≥—Ä–∞–π –∏ –Ω–∞–π–¥–∏ —Å–≤–æ–π —Å—Ç–∏–ª—å</p>
            <p><button class="btn pulse" id="startBtn">üïπ –ò–≥—Ä–∞—Ç—å</button></p>
          </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã -->
        <div class="overlay" id="gameOver" hidden>
          <div class="screen">
            <span class="badge" id="newRecordBadge">–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!</span>
            <p class="title">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</p>
            <p class="subtitle">–°—á—ë—Ç: <b id="finalScore">0</b> ¬∑ –†–µ–∫–æ—Ä–¥: <b id="finalBest">0</b></p>
            <p class="subtitle">
              <a class="btn" href="https://clck.ru/3PW6wp" target="_blank" rel="noopener">üõç –°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ WB</a>
            </p>
            <p style="display:flex; gap:8px; justify-content:center;">
              <button class="btn" id="shareBtn">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
              <button class="btn ghost" id="againBtn">–ï—â—ë —Ä–∞–∑</button>
            </p>
          </div>
        </div>
      </div>

      <footer>¬© MUVIT ‚Äî –∏–≥—Ä–∞–π –∏ –Ω–∞–π–¥–∏ —Å–≤–æ–π —Å—Ç–∏–ª—å</footer>
    </div>
  </div>

<script>
(() => {
  const teesSrc = ['assets/tee1.png','assets/tee2.png','assets/tee3.png','assets/tee4.png','assets/tee5.png','assets/tee6.png','assets/tee7.png','assets/tee8.png'];

  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  const W = 640, H = 960;
  canvas.width = W * DPR; canvas.height = H * DPR; canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
  ctx.scale(DPR, DPR);

  const scoreEl = document.getElementById('score');
  const livesEl = document.getElementById('lives');
  const bestEl = document.getElementById('best');
  const startScreen = document.getElementById('startScreen');
  const gameOver = document.getElementById('gameOver');
  const startBtn = document.getElementById('startBtn');
  const againBtn = document.getElementById('againBtn');
  const shareBtn = document.getElementById('shareBtn');
  const finalScore = document.getElementById('finalScore');
  const finalBest = document.getElementById('finalBest');
  const newRecordBadge = document.getElementById('newRecordBadge');

  // Images
  const images = teesSrc.map(src => { const i=new Image(); i.src=src; return i; });
  function rand(a,b){ return a + Math.random()*(b-a); }
  const tees = [];
  const effects = [];
  let running=false, score=0, lives=3, best=+localStorage.getItem('muvit_best')||0;
  bestEl.textContent = best;
  let t=0, last=0, lastSpawn=0, speed=170;
  let isNewRecord = false;

  function spawn(){
    const size = rand(72, 120);
    const x = rand(size*0.5, W - size*0.5);
    const y = -size;
    const vy = rand(speed*0.8, speed*1.25);
    const img = images[Math.floor(Math.random()*images.length)];
    const rot = rand(-0.18,0.18);
    const spin = rand(-0.5,0.5);
    tees.push({x,y,vy,size,img,rot,spin});
  }
  function drawBG(){
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#edf3f7'); g.addColorStop(1,'#e4eef5');
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
  }
  function draw(){
    drawBG();
    for(const te of tees){
      ctx.save(); ctx.translate(te.x, te.y); ctx.rotate(te.rot);
      const w = te.size, h = te.size * (te.img.naturalHeight? te.img.naturalHeight/te.img.naturalWidth : 1.1);
      ctx.drawImage(te.img, -w/2, -h/2, w, h); ctx.restore();
    }
    // confetti
    for(const e of effects){
      ctx.globalAlpha = e.a; ctx.fillStyle = e.c; ctx.beginPath(); ctx.arc(e.x,e.y,e.r,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
    }
  }
  function update(dt){
    t += dt; speed += dt*2;
    if(t - lastSpawn > Math.max(0.2, 0.9 - t*0.02)){ spawn(); lastSpawn=t; }
    for(let i=tees.length-1;i>=0;i--){
      const te = tees[i];
      te.y += te.vy * dt; te.rot += te.spin * dt;
      if(te.y - te.size/2 > H){ tees.splice(i,1); miss(); }
    }
    for(let i=effects.length-1;i>=0;i--){
      const e = effects[i]; e.r += 60*dt; e.a -= 1.2*dt; if(e.a<=0) effects.splice(i,1);
    }
  }
  function loop(ts){
    if(!running){ last = ts; return; }
    const dt = Math.min(0.033, (ts - last)/1000); last = ts;
    update(dt); draw(); requestAnimationFrame(loop);
  }
  function start(){
    score=0; lives=3; t=0; lastSpawn=0; speed=170; tees.length=0; effects.length=0; isNewRecord=false;
    scoreEl.textContent=score; livesEl.textContent=lives;
    startScreen.hidden = true; gameOver.hidden=true; running=true;
    requestAnimationFrame(ts=>{ last=ts; loop(ts); });
  }
  function end(){
    running=false;
    const prevBest = best;
    if(score > best){ best = score; isNewRecord = true; localStorage.setItem('muvit_best', best); }
    finalScore.textContent=score; finalBest.textContent=best; bestEl.textContent=best;
    gameOver.hidden=false;
    // show new record badge + confetti
    newRecordBadge.style.display = isNewRecord ? 'inline-block' : 'none';
    if(isNewRecord){ for(let i=0;i<80;i++) effects.push({x:rand(40,W-40), y:rand(80, H-200), r:rand(2,6), a:.9, c:`hsl(${Math.floor(rand(0,360))},90%,60%)`}); draw(); }
  }
  function miss(){ lives--; livesEl.textContent=lives; if(lives<=0) end(); }
  function getPos(e){ const r=canvas.getBoundingClientRect(); const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left; const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top; return {x,y}; }
  function hit(x,y){
    for(let i=tees.length-1;i>=0;i--){
      const te = tees[i]; const r = te.size*0.6; const dx = x - te.x; const dy = y - te.y;
      if(dx*dx + dy*dy < r*r){ tees.splice(i,1); score++; scoreEl.textContent=score; effects.push({x,y,r:6,a:.7,c:'rgba(227,128,30,.35)'}); return true; }
    } effects.push({x,y,r:4,a:.5,c:'rgba(0,0,0,.15)'}); return false;
  }

  // Share button (Web Share API + fallback)
  async function share() {
    const url = location.href;
    const text = `–ú–æ–π —Å—á—ë—Ç: ${score}. –ü–æ–π–º–∞–π —Ñ—É—Ç–±–æ–ª–∫—É –æ—Ç MUVIT!`;
    try {
      if (navigator.share) {
        await navigator.share({ title: '–ü–æ–π–º–∞–π —Ñ—É—Ç–±–æ–ª–∫—É ‚Äî MUVIT', text, url });
      } else if (navigator.clipboard) {
        await navigator.clipboard.writeText(url);
        alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
      } else {
        prompt('–°–∫–æ–ø–∏—Ä—É–π —Å—Å—ã–ª–∫—É:', url);
      }
    } catch (e) {
      console.log(e);
    }
  }

  canvas.addEventListener('click', e=>{ if(running){ const p=getPos(e); hit(p.x,p.y); } });
  canvas.addEventListener('touchstart', e=>{ if(running){ const p=getPos(e); hit(p.x,p.y); } }, {passive:true});
  startBtn.onclick = () => start();
  againBtn && (againBtn.onclick = () => start());
  shareBtn && (shareBtn.onclick = () => share());

  // initial preview
  draw();
})();
</script>
</body>
</html>
